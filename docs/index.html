<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>20211208 - Failing to switch the christmas lights - hardcodes</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="20211208--1.html"><strong aria-hidden="true">1.</strong> 20211208 - Failing to switch the christmas lights</a></li><li class="chapter-item expanded "><a href="20211130--1.html"><strong aria-hidden="true">2.</strong> 20211130 - Getting a little rusty</a></li><li class="chapter-item expanded "><a href="20210502--1.html"><strong aria-hidden="true">3.</strong> 20210502 - Going Solarish</a></li><li class="chapter-item expanded "><a href="20150125--1.html"><strong aria-hidden="true">4.</strong> 20150125 - Swing like a pendulum</a></li><li class="chapter-item expanded "><a href="20141230--1.html"><strong aria-hidden="true">5.</strong> 20141230 - Build cmake command-line tool on OSX</a></li><li class="chapter-item expanded "><a href="20140920--1.html"><strong aria-hidden="true">6.</strong> 20140920 - Build ZeroMQ on OSX</a></li><li class="chapter-item expanded "><a href="20140918--2.html"><strong aria-hidden="true">7.</strong> 20140918 - Build CEGUI library on OSX</a></li><li class="chapter-item expanded "><a href="20140918--1.html"><strong aria-hidden="true">8.</strong> 20140918 - Build CEGUI dependencies on OSX</a></li><li class="chapter-item expanded "><a href="20140830--1.html"><strong aria-hidden="true">9.</strong> 20140830 - Do it yourself</a></li><li class="chapter-item expanded "><a href="20140803--1.html"><strong aria-hidden="true">10.</strong> 20140803 - Farewell Jolla</a></li><li class="chapter-item expanded "><a href="20140619--1.html"><strong aria-hidden="true">11.</strong> 20140619 - Ding dong - the switch is dead</a></li><li class="chapter-item expanded "><a href="20140608--1.html"><strong aria-hidden="true">12.</strong> 20140608 - FUSE for OSX - mount the little boat</a></li><li class="chapter-item expanded "><a href="20140607--1.html"><strong aria-hidden="true">13.</strong> 20130607 - The carrot and the stick - there are silver linings</a></li><li class="chapter-item expanded "><a href="20140601--1.html"><strong aria-hidden="true">14.</strong> 20130601 - The art of raising expectations and to fail on them</a></li><li class="chapter-item expanded "><a href="20140501--1.html"><strong aria-hidden="true">15.</strong> 20140501 - Secure passwords on SailfishOS? Grandfather, tell me a story!</a></li><li class="chapter-item expanded "><a href="20140428--1.html"><strong aria-hidden="true">16.</strong> 20140428 - 0,3 or 5 - make it your rule</a></li><li class="chapter-item expanded "><a href="20140409--1.html"><strong aria-hidden="true">17.</strong> 20140409 - Data races in STL containers</a></li><li class="chapter-item expanded "><a href="20140408--1.html"><strong aria-hidden="true">18.</strong> 20140408 - Pump up the message - blocked from the promised future</a></li><li class="chapter-item expanded "><a href="20140121--1.html"><strong aria-hidden="true">19.</strong> 20140121 - Model, model on the wall...</a></li><li class="chapter-item expanded "><a href="20140120--1.html"><strong aria-hidden="true">20.</strong> 20140120 - HelloWorld! using a library on SailfishOS 2</a></li><li class="chapter-item expanded "><a href="20140118--1.html"><strong aria-hidden="true">21.</strong> 20140118 - SailfishOS - what's pkg-config?</a></li><li class="chapter-item expanded "><a href="20140116--1.html"><strong aria-hidden="true">22.</strong> 20140116 - HelloWorld! using a library on SailfishOS 1</a></li><li class="chapter-item expanded "><a href="20140114--1.html"><strong aria-hidden="true">23.</strong> 20140114 - Sometimes you need to put your finger on the product</a></li><li class="chapter-item expanded "><a href="20140112--1.html"><strong aria-hidden="true">24.</strong> 20140112 - Organize your data or stop being all over the map</a></li><li class="chapter-item expanded "><a href="20131228--1.html"><strong aria-hidden="true">25.</strong> 20131228 - Jolla wish list - reality check</a></li><li class="chapter-item expanded "><a href="20131217--1.html"><strong aria-hidden="true">26.</strong> 20131207 - Developing with SailfishOS - a short introduction</a></li><li class="chapter-item expanded "><a href="20131115--1.html"><strong aria-hidden="true">27.</strong> 20131115 - Shameless Plug</a></li><li class="chapter-item expanded "><a href="20131112--1.html"><strong aria-hidden="true">28.</strong> 20131112 - State Machines - Meeting C++ 2013 aftermath 1</a></li><li class="chapter-item expanded "><a href="20131024--1.html"><strong aria-hidden="true">29.</strong> 20131024 - Jolla / SailfishOS wishlist (updated)</a></li><li class="chapter-item expanded "><a href="20131020--1.html"><strong aria-hidden="true">30.</strong> 20131020 - Raspberry Pi crashes AKA &quot;journal commit I/O error&quot;</a></li><li class="chapter-item expanded "><a href="20131019--2.html"><strong aria-hidden="true">31.</strong> 20131019 - Use clang-format with QtCreator</a></li><li class="chapter-item expanded "><a href="20131019--1.html"><strong aria-hidden="true">32.</strong> 20131019 - Building clang-format and friends on OSX Mountain Lion</a></li><li class="chapter-item expanded "><a href="20131016--1.html"><strong aria-hidden="true">33.</strong> 20131016 - Writing your own nslookup in C++</a></li><li class="chapter-item expanded "><a href="20130924--1.html"><strong aria-hidden="true">34.</strong> 20130924 - Poor man's surveillance system with Raspberry Pi</a></li><li class="chapter-item expanded "><a href="20130910--1.html"><strong aria-hidden="true">35.</strong> 20130910 - Windows7 icon cache corrupt</a></li><li class="chapter-item expanded "><a href="20130822--1.html"><strong aria-hidden="true">36.</strong> 20130822 - OSX Mountain Lion - screensaver can not show your iPhoto library anymore</a></li><li class="chapter-item expanded "><a href="20130809--2.html"><strong aria-hidden="true">37.</strong> 20130809 - #Snowden, #NSA, #cloud, #surveillance, #escape</a></li><li class="chapter-item expanded "><a href="20130809--1.html"><strong aria-hidden="true">38.</strong> 20130809 - Howto setup a pseudo-remote Qt project</a></li><li class="chapter-item expanded "><a href="20130707--1.html"><strong aria-hidden="true">39.</strong> 20130707 - Timemachine and encrypted volumes - no paste possible - data save as in a vault</a></li><li class="chapter-item expanded "><a href="20130625--1.html"><strong aria-hidden="true">40.</strong> 20130625 - Howto Git?!</a></li><li class="chapter-item expanded "><a href="20130620--1.html"><strong aria-hidden="true">41.</strong> 20130620 - Cloning the Qt git repository into a corporate environment</a></li><li class="chapter-item expanded "><a href="20130618--1.html"><strong aria-hidden="true">42.</strong> 20130618 - Inside the belly of the beast</a></li><li class="chapter-item expanded "><a href="20130610--1.html"><strong aria-hidden="true">43.</strong> 20130610 - Powershell - get Active Directory User accounts with no employee number set</a></li><li class="chapter-item expanded "><a href="20130602--1.html"><strong aria-hidden="true">44.</strong> 20130602 - Boost up again</a></li><li class="chapter-item expanded "><a href="20130527--1.html"><strong aria-hidden="true">45.</strong> 20130527 - Why I believe in Jolla</a></li><li class="chapter-item expanded "><a href="20130520--1.html"><strong aria-hidden="true">46.</strong> 20130520 - Welcome aboard sailor!</a></li><li class="chapter-item expanded "><a href="20130423--1.html"><strong aria-hidden="true">47.</strong> 20130423 - Boost libraries and QtCreator on OSX - all together now</a></li><li class="chapter-item expanded "><a href="20130421--1.html"><strong aria-hidden="true">48.</strong> 20130421 - Using the Boost libraries with QtCreator on OSX</a></li><li class="chapter-item expanded "><a href="20130418--1.html"><strong aria-hidden="true">49.</strong> 20130418 - Boost libraries on OSX - obstacles almost gone</a></li><li class="chapter-item expanded "><a href="20130415--2.html"><strong aria-hidden="true">50.</strong> 20130415 - Handling the program version with Qt, part 2</a></li><li class="chapter-item expanded "><a href="20130415--1.html"><strong aria-hidden="true">51.</strong> 20130415 - Handling the program version with Qt, part 1</a></li><li class="chapter-item expanded "><a href="20130414--1.html"><strong aria-hidden="true">52.</strong> 20130414 - Pimp the clean process in QtCreator</a></li><li class="chapter-item expanded "><a href="20130331--1.html"><strong aria-hidden="true">53.</strong> 20130331 - Boost libraries on OSX - first obstacles</a></li><li class="chapter-item expanded "><a href="20130329--1.html"><strong aria-hidden="true">54.</strong> 20130329 - Boost libraries on OSX - first contact</a></li><li class="chapter-item expanded "><a href="20130327--1.html"><strong aria-hidden="true">55.</strong> 20130327 - Apple: a developers nightmare</a></li><li class="chapter-item expanded "><a href="20130325--1.html"><strong aria-hidden="true">56.</strong> 20130325 - iOS most wanted (updated)</a></li><li class="chapter-item expanded "><a href="20130305--1.html"><strong aria-hidden="true">57.</strong> 20130503 - Annoying addons</a></li><li class="chapter-item expanded "><a href="20130227--1.html"><strong aria-hidden="true">58.</strong> 20130227 - Time to patch your Flash Player again</a></li><li class="chapter-item expanded "><a href="20130208--1.html"><strong aria-hidden="true">59.</strong> 20130208 - Useless features, part 2</a></li><li class="chapter-item expanded "><a href="20130123--1.html"><strong aria-hidden="true">60.</strong> 20130123 - Need some Valgrind for OSX Lion?</a></li><li class="chapter-item expanded "><a href="20130121--1.html"><strong aria-hidden="true">61.</strong> 20130121 - NOTE: a missing vtable usually means the first non-inline virtual member function has no definition. Part 2</a></li><li class="chapter-item expanded "><a href="20130115--1.html"><strong aria-hidden="true">62.</strong> 20130115 - NOTE: a missing vtable usually means the first non-inline virtual member function has no definition. Part 1</a></li><li class="chapter-item expanded "><a href="20121101--2.html"><strong aria-hidden="true">63.</strong> 20121101 - JumpyRally</a></li><li class="chapter-item expanded "><a href="20121101--1.html"><strong aria-hidden="true">64.</strong> 20121101 - Quickminder</a></li><li class="chapter-item expanded "><a href="20121016--1.html"><strong aria-hidden="true">65.</strong> 20121016 - Open with...</a></li><li class="chapter-item expanded "><a href="20121013--1.html"><strong aria-hidden="true">66.</strong> 20121013 - Old habits</a></li><li class="chapter-item expanded "><a href="20121006--1.html"><strong aria-hidden="true">67.</strong> 20121006 - Daily UI hell</a></li><li class="chapter-item expanded "><a href="20120926--1.html"><strong aria-hidden="true">68.</strong> 20120926 - Useless features</a></li><li class="chapter-item expanded "><a href="20120923--1.html"><strong aria-hidden="true">69.</strong> 20120923 - How Appleâ€™s Obsession with Google Is Hurting Apple</a></li><li class="chapter-item expanded "><a href="20120922--1.html"><strong aria-hidden="true">70.</strong> 20120922 - QuickMinder and iOS6, game over?</a></li><li class="chapter-item expanded "><a href="20120921--1.html"><strong aria-hidden="true">71.</strong> 20120921 - Apple and a..h.l.s</a></li><li class="chapter-item expanded "><a href="20120913--1.html"><strong aria-hidden="true">72.</strong> 20120913 - Apple goes south</a></li><li class="chapter-item expanded "><a href="20120912--1.html"><strong aria-hidden="true">73.</strong> 20120912 - 999 USD</a></li><li class="chapter-item expanded "><a href="20120817--1.html"><strong aria-hidden="true">74.</strong> 20120817 - On to pastures new</a></li><li class="chapter-item expanded "><a href="20120813--1.html"><strong aria-hidden="true">75.</strong> 20120813 - Play with Qt</a></li><li class="chapter-item expanded "><a href="20120727--1.html"><strong aria-hidden="true">76.</strong> 20120627 - Change network adapter setting on Windows Server 2008 R2</a></li><li class="chapter-item expanded "><a href="20120716--1.html"><strong aria-hidden="true">77.</strong> 20120716 - Trust the cloud</a></li><li class="chapter-item expanded "><a href="20120704--1.html"><strong aria-hidden="true">78.</strong> 20120407 - Back to the Mac</a></li><li class="chapter-item expanded "><a href="20120621--1.html"><strong aria-hidden="true">79.</strong> 20120621 - How to ask questions</a></li><li class="chapter-item expanded "><a href="20120620--1.html"><strong aria-hidden="true">80.</strong> 20120620 - Find the button</a></li><li class="chapter-item expanded "><a href="20120603--1.html"><strong aria-hidden="true">81.</strong> 20120603 - ITIL burger anyone?</a></li><li class="chapter-item expanded "><a href="20120610--1.html"><strong aria-hidden="true">82.</strong> 20120610 - One-way globalization</a></li><li class="chapter-item expanded "><a href="20120619--1.html"><strong aria-hidden="true">83.</strong> 20120619 - No filesystem needed?</a></li><li class="chapter-item expanded "><a href="20120601--2.html"><strong aria-hidden="true">84.</strong> 20120601 - I need space</a></li><li class="chapter-item expanded "><a href="20120601--3.html"><strong aria-hidden="true">85.</strong> 20120601 - Jumpy on Amiga</a></li><li class="chapter-item expanded "><a href="20120601--1.html"><strong aria-hidden="true">86.</strong> 20120601 - Yes, it's a blog!</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">hardcodes</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#failing-to-switch-the-christmas-lights" id="failing-to-switch-the-christmas-lights">Failing to switch the christmas lights</a></h1>
<p>No so recently - more like 2020 - I've bought a set of power sockets at a German <em>Lidl</em> branch named <em>SilverCrest Funksteckdosen-Set</em> (IAN 32813_2001, produced by ROWI Germany GmbH) that can be controlled via a 433 MHz remote. 433 MHz is part of the <a href="https://en.wikipedia.org/wiki/ISM_band">ISM band</a> which is reserved internationally for <strong>i</strong>ndustrial, <strong>s</strong>cientific and <strong>m</strong>edical purposes.</p>
<p>The set consists of 4 power sockets that go into learning mode the first 30 seconds after being plugged in. By pressing the <em>on</em> button of channel <em>A</em>, <em>B</em>, <em>C</em> or <em>D</em> on the remote control the socket is assigned to the respective channel. In that way it differs from the models that are described in some of the German blog posts, e.g. <a href="https://hartgeloetet.blogspot.com/2014/05/hacking-intertec-funksteckdosen.html"> Hacking Intertec Funksteckdosen </a> or <a href="https://itooktheredpill.irgendwo.org/2013/funksteckdosen-hacken/">3 Wege zum Funksteckdosen hacken</a>. Those sockets and remotes used DIP switches to encode/decode the individual channel and therefore a relation between the binary value of the DIP switches and the transmitted signal could be etsablished.</p>
<p><strong>NOTE:</strong>  There is no communication outgoing from the socket itself. </p>
<p>For decoding and later on sending of the bitstream I've ordered a cheap 433 MHz wireless transmitter and receiver module set.</p>
<h1><a class="header" href="#decoding" id="decoding">Decoding</a></h1>
<p>To decode the signal, I've connected an oscilloscope to the <em>RX</em> pin of the receiver. There is a lot of noise, when no button is pressed on the remote.</p>
<p><img src="./gfx/noise.png" alt="Image shows the noise beeing captured when no signal is activeliy trasnmitted." /></p>
<p>Probably the device uses some kind of automatic gain control and cranks up the input if there is no real input. Those cheap transmitter and receiver modules use a simple <a href="https://en.wikipedia.org/wiki/On%E2%80%93off_keying">OOK</a> (on off keying) mechanism to transfer the data with the radio wave. <a href="https://www.youtube.com/watch?v=w6V9NyXwohI">Communicating with 433MHz OOK/ASK wireless modules (#88)</a> is a (Arduino based) video that explains in fairly good details what's going on.</p>
<p>Nevertheless the signal can be recorded, when a button on the remote was pressed. As an example, here is an image of pressing the <em>on</em> button for channel <em>A</em>:</p>
<p><img src="./gfx/A--on.png" alt="" /></p>
<p>I am still wondering though why the long lasting sequences of low signals are not disturbed from noise if there is nothing beeing transmitted to signal a low value. Maybe it is not just <em>OOK</em> but also a combination with the simplest type of <a href="https://en.wikipedia.org/wiki/Amplitude-shift_keying">ASK</a> (amplitude shift keying). While the Wikipedia article might be correct, the approach is too mathematical for my personal taste. Have a look at this image:</p>
<p><img src="https://www.elektroniktutor.de/signalkunde/sig_pict/ask1.png" alt="Image from https://www.elektroniktutor.de/signalkunde/ask.html showing the waveform used for a simple ASK implementation utilizing two different amplitudes to represent high and low values." /></p>
<p>It is hosted on <a href="https://www.elektroniktutor.de/signalkunde/ask.html">this German website</a> explaining ASK. The right side shows a waveform used for a simple ASK implementation utilizing two different amplitudes to represent high and low values.</p>
<p>So much for the physical characteristics of the transmitted signal. On top of that there could be used a <a href="https://en.wikipedia.org/wiki/Manchester_code">Manchester Encoding</a> from the remote control which would give us the clock information. But there are quite long periods of low values in the signal, so that I don't think that this kind of encoding takes place. For a pure replay it doesn't matter anyway, since we must simply be able to create the same sequence of low and high values with a correct timing.</p>
<p>The signal seems to lack any kind of preamble, e.g. <code>10101010</code> or <code>01010101</code>, it cuts right to the chase.</p>
<p>After taking a screenshot of every signal from each button, here is a table with the binary decoded signals.</p>
<table><thead><tr><th align="center">Chn</th><th align="left">status</th><th align="left">bitstream</th></tr></thead><tbody>
<tr><td align="center">A</td><td align="left">on</td><td align="left"><code>10010011 01001001 00100110 11011010 01101101 10100100 10011011 01001101 10100100 11111100</code></td></tr>
<tr><td align="center">A</td><td align="left">off</td><td align="left"><code>10010011 01001101 10110110 11011010 01001001 10100100 10010011 01001101 10100100 11111100</code></td></tr>
<tr><td align="center"></td><td align="left"></td><td align="left"></td></tr>
<tr><td align="center">B</td><td align="left">on</td><td align="left"><code>10010011 01001101 00110100 10011010 01101001 10110110 10010011 01101001 10100110 11111100</code></td></tr>
<tr><td align="center">B</td><td align="left">off</td><td align="left"><code>10010011 01001001 10100100 11011011 01001001 10110100 11011010 01101001 10100110 11111100</code></td></tr>
<tr><td align="center"></td><td align="left"></td><td align="left"></td></tr>
<tr><td align="center">C</td><td align="left">on</td><td align="left"><code>10010011 01001001 10100110 11010010 01101101 00100100 11010011 01101101 10110100 11111100</code></td></tr>
<tr><td align="center">C</td><td align="left">off</td><td align="left"><code>10010011 01001101 10100110 10010011 01001001 10100110 10011010 01101101 10110100 11111100</code></td></tr>
<tr><td align="center"></td><td align="left"></td><td align="left"></td></tr>
<tr><td align="center">D</td><td align="left">on</td><td align="left"><code>10010011 01001101 00110110 10010011 01101101 10110100 10011010 01001001 10110110 11111100</code></td></tr>
<tr><td align="center">D</td><td align="left">off</td><td align="left"><code>10010011 01001101 10100100 11010011 01001101 00110110 11011011 01101001 10110110 11111100</code></td></tr>
<tr><td align="center"></td><td align="left"></td><td align="left"></td></tr>
<tr><td align="center">Master</td><td align="left">on</td><td align="left"><code>10010011 01001001 10110110 11011011 01101001 00110100 10011011 01101001 00110100 11111100</code></td></tr>
<tr><td align="center">Master</td><td align="left">off</td><td align="left"><code>10010011 01001001 00100110 11011010 01101101 10100100 10011011 01001001 00110100 11111100</code></td></tr>
</tbody></table>
<p>Each bit lasts 0.5 ms, therefore 2000 bits are transferred per second:</p>
<pre><code>1 / 0.0005 = 2000
</code></pre>
<p><strong>NOTE:</strong> the bit sequences are repeated as long as the button is pressed on the remote control.</p>
<p>Since the power sockets must be teached in a 30 second time window, I assume that every remote control has its own specific code, so that customers don't interfere, should they buy the same system. Lacking another remote control, I can't validate that. But my guess is, that most of the bits encode the serial number of the remote control and only some of them the action (switch on or off) and maybe some the version or brand of the system.</p>
<h1><a class="header" href="#send-the-code-take-1" id="send-the-code-take-1">Send the code, take 1</a></h1>
<p>The plan was to send the code through an USB ttl converter to the 433 Mhz tranceiver. Finally this should be done with a small Rust program.</p>
<h2><a class="header" href="#send-the-code-or-how-to-fail" id="send-the-code-or-how-to-fail">Send the code, or how to fail</a></h2>
<p>But first we need a proof of concept:</p>
<ul>
<li>
<p>I've inserted a power socket, paired it with the A channel and switched it off.</p>
</li>
<li>
<p>Then I wrote the data for Channel <em>A</em> and status <em>on</em> to a binary file.</p>
</li>
<li>
<p>Next I tried to write this data with <code>cat a-on.bin &gt; /dev/ttyUSB0</code> to the tty device and stumbled:</p>
<ol>
<li>You cannot set a baudrate of 2000 with the <code>stty</code> command, the next fitting and accepted speed is <code>2400</code>.</li>
<li>Stop bits cannot be disabled.</li>
</ol>
<p>Yes, of course. It is a serial terminal connection, I simply hoped that this could be overridden.</p>
</li>
<li>
<p>Due to the wrong speed and the added stop bits the socket would not turn on.</p>
</li>
</ul>
<h2><a class="header" href="#send-the-code-take-the-blue-pill-and-fail-again" id="send-the-code-take-the-blue-pill-and-fail-again">Send the code, take the blue pill and fail again</a></h2>
<p>For the next try I used a <a href="https://stm32duinoforum.com/forum/wiki_subdomain/index_title_Blue_Pill.html">blue pill</a> board and wrote a simple program to send the desired bit pattern. To spice things up, I decided to write the code in Rust. To set up the environment I followed <a href="https://cgit.pinealservo.com/BluePill_Rust/resources/issues/1">these instructions </a> well knowing of the existence of the <a href="https://rust-embedded.github.io/book/">Rust embedded book</a>.</p>
<ul>
<li>
<p>First I tried the *hello world&quot; from the <a href="https://cgit.pinealservo.com/BluePill_Rust/blue_pill_base">Utah Rust Usergroup</a>, only to</p>
<ul>
<li>learn that I need to <a href="http://www.emcu.eu/how-to-update-the-st-link-fw-under-linux/">update</a> the firmware of the ST-Link V2 programmer.</li>
<li>Afterwards I could compile and flash the code and the LED on pc13 started to blink ten times in a slow pace.</li>
</ul>
</li>
<li>
<p>Then I <a href="./examples/bluepill-hardcoded-take1.rs">hard coded</a> (can you say hardcodes?) the values to switch on a socket via channel <em>A</em> into the code and watched the result with an oscilloscope.</p>
<ul>
<li>
<p>That looked promising:</p>
<p><img src="./gfx/A--on--hardcoded.png" alt="Image shows the captured waveform from the remote control and the waveform generated from the blue pill board" /></p>
</li>
<li>
<p>After <a href="#Wiring">wiring</a> up the transmitter I could sometimes successfully switch on the socket.</p>
</li>
</ul>
<p>But why only sometimes?</p>
<ul>
<li>The bit sequence seems to be correct, maybe it is</li>
<li>the pause between the sequences? Playing around with them did not help very much. <code>10 ms</code> seemed to be the most successful variant.</li>
<li>the number of repetitions seems to be irrelevant, since it it changes when using the remote depending on how long the button is pressed.</li>
<li>it may be the amplitude of the signal but I doubt that, since the remote works even on a distance of a few meters with walls inbetween.</li>
<li>it may be the finnicky wiring of a bread board.</li>
<li>or it may be even the cheap transmitter.</li>
</ul>
</li>
</ul>
<p>After hooking up the oscilloscope to the receiver again, I learned that I just recorded and decoded a part of the signal. Here we go again...</p>
<h1><a class="header" href="#decoding-take-2" id="decoding-take-2">Decoding, take 2</a></h1>
<p>Here is a full image of the <em>turn channel A on</em> sequence with the bytes marked in an alternating color:</p>
<p><img src="./gfx/A--on--overview.png" alt="Imgaes shows the oscilloscope a complete overview from turning channel A on" /></p>
<p>Remarkable is the 4 time repetition of the part of the signal, I've already <a href="#Decoding">decoded</a> during take 1. Since the complete sequence is repeated as long as the button is pressed on the remote, I mistook that part of the signal for the complete sequence. And it does not start on a byte boundary. I probably wouldn't have noticed the repeating pattern at all, if I did it right the first take. At least I saved some time decoding that part :-D</p>
<h2><a class="header" href="#decoding-take-2-detour" id="decoding-take-2-detour">Decoding, take 2, detour</a></h2>
<p>Just when I was on the verge of decoding the singals again, I stumbled upon the <a href="https://sigrok.org/wiki/PulseView">PulseView</a> project. So I exported the data from my oscilloscope as binary <code>wav</code> formatted file and tried to import that into <em>PulseView</em>, which did not work at all. A small detour using <a href="https://www.audacityteam.org/">Audacity</a> made it possible nevertheless.</p>
<ul>
<li>
<p>Import the file as <em>raw data</em> into <em>Audacity</em></p>
<p><img src="./gfx/a--on--audacity--import.png" alt="Imgage shows imported wav file from the oscilloscope in Audacity" /></p>
</li>
<li>
<p>Cut away the noise at the beginning and the end</p>
</li>
<li>
<p>Normalize</p>
</li>
<li>
<p>Export a <code>wav</code> file</p>
</li>
<li>
<p>Import into <em>PulseView</em></p>
</li>
<li>
<p>Add an <em>OOK</em> decoder and fail to decode. The decoder seems to look for a preamble to guess the timing of the signal.</p>
</li>
<li>
<p>Add an artificial preamble the signal
<img src="./gfx/a--on--audacity-with-preamble.png" alt="Imgage shows imported wav file from the oscilloscope in Audacity plus the added preable representing 10101010." /></p>
</li>
<li>
<p>Cut away the noise at the beginning and the end</p>
</li>
<li>
<p>Normalize</p>
</li>
<li>
<p>Export a <code>wav</code> file</p>
</li>
<li>
<p>Import into <em>PulseView</em></p>
</li>
<li>
<p>Add an <em>OOK</em> decoder and decode...
<img src="./gfx/a--on--pulseview-ook.png" alt="Image shows imported wav file from Audacity in PulseView with an applied OOK decoder" /></p>
<p>...again. Better than the last time but still not helpfull.</p>
</li>
<li>
<p>Maybe I am just too inexperienced in using <em>PulseView</em>.</p>
</li>
</ul>
<p>Anyway, back to doing it by hand.</p>
<h2><a class="header" href="#decoding-take-2-do-it-by-hand" id="decoding-take-2-do-it-by-hand">Decoding, take 2, do it by hand</a></h2>
<p>Here is the result for the binary decoded signal.</p>
<table><thead><tr><th align="center">Chn</th><th align="left">status</th><th align="left">bitstream</th></tr></thead><tbody>
<tr><td align="center">A</td><td align="left">on</td><td align="left"><code>10000100 10011010 01001001 00110110 11010011 01101101 00100100 11011010</code></td></tr>
<tr><td align="center"></td><td align="left"></td><td align="left"><code>01101101 00100100 00100100 11010010 01001001 10110110 10011011 01101001</code></td></tr>
<tr><td align="center"></td><td align="left"></td><td align="left"><code>11010011 01101001 00100001 00100110 10010010 01001101 10110100 11011011</code></td></tr>
<tr><td align="center"></td><td align="left"></td><td align="left"><code>01001001 00110110 10011011 01001001 00001001 00110100 10010010 01101101</code></td></tr>
<tr><td align="center"></td><td align="left"></td><td align="left"><code>10100110 11011010 01001001 10110100 11011010 01001111 11000000 00000000</code></td></tr>
<tr><td align="center"></td><td align="left"></td><td align="left"><code>10010011 01001001 00100110 11011010 01101101 10100100 10011011 01001101</code></td></tr>
<tr><td align="center"></td><td align="left"></td><td align="left"><code>10100100 11111100 00000000 00001001 00110100 10010010 01101101 10100110</code></td></tr>
<tr><td align="center"></td><td align="left"></td><td align="left"><code>11011010 01001001 10110100 11011010 01001111 11000000 00000000 10010011</code></td></tr>
<tr><td align="center"></td><td align="left"></td><td align="left"><code>01001001 00100110 11011010 01101101 10100100 10011011 01001101 10100100</code></td></tr>
<tr><td align="center"></td><td align="left"></td><td align="left"><code>11111100 00000000 00001001 00110100 10010010 01101101 10100110 11011010</code></td></tr>
<tr><td align="center"></td><td align="left"></td><td align="left"><code>01001001 10110100 11011010 01000000 00000000 00000000 00000000 00000000</code></td></tr>
<tr><td align="center"></td><td align="left"></td><td align="left"><code>00000000 00000000 00000000 00000000 00000000</code></td></tr>
</tbody></table>
<h1><a class="header" href="#send-the-code-take-2" id="send-the-code-take-2">Send the code, take 2</a></h1>
<p>Of course having just the static code to switch on a socket on channel <em>A</em> does not get me anywhere. The final step is <a href="#The-Code">the code</a> in this repostory. The blue pill awaits the bytes to be send from the USB serial interface and shifts the bit values to GPIO pin <code>B15</code> to feed the transmitter.</p>
<h1><a class="header" href="#wiring" id="wiring">Wiring</a></h1>
<p>Wiring the blue pill board and the 433 MHz transmitter is very easy. Simply connect <code>3.3V</code> and <code>GND</code> of the blue pill and the transmitter board. Finally connret pin B15 of the blue pill board with the remaining pin of the transmitter.</p>
<p><img src="./gfx/breadboard--wiring.png" alt="Image was made with Fritzing ad shows the wiring of the blue pill board with the transmitter attached." /></p>
<h1><a class="header" href="#let-there-be-light" id="let-there-be-light">Let there be light</a></h1>
<p>Since this little project is not finished yet, I installed those four plugs and simply use the remote control.</p>
<ul>
<li>Plug 1 is trained on button A</li>
<li>Plug 2 is trained on button B</li>
<li>Plug 3 is trained on button C</li>
<li>Plug 4 is trained on button D</li>
</ul>
<p>If I press button A, plug A turns on (or off). If I press button B, plug 2 and plug 3 turn on (or off) and other weird combinations. Before starting this whole thing I should have tested all four plugs. The only thing that works like a charm is the master on/off switch. Maybe I come back later and finish this little project but as of now the remote works just fine ;-)</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        
                            <a rel="next" href="20211130--1.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
                    <a rel="next" href="20211130--1.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
